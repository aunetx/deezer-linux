{
  "scripts": {
    "copy-resources": "mkdir -p resources/linux && cp ../extra/linux/* ./resources/linux",
    "start": "yarn run copy-resources && electron .",
    "prepare-flatpak": "electron-builder --linux --dir",

    "build-flatpak-x64": "env DEBUG='@malept/flatpak-bundler' electron-builder --x64 --linux flatpak",
    "build-flatpak-arm64": "env DEBUG='@malept/flatpak-bundler' electron-builder --arm64 --linux flatpak",

    "build-tar.xz-x64": "electron-builder --x64 --linux tar.xz",
    "build-deb-x64": "electron-builder --x64 --linux deb",
    "build-rpm-x64": "electron-builder --x64 --linux rpm",
    "build-snap-x64": "electron-builder --x64 --linux snap",
    "build-appimage-x64": "electron-builder --x64 --linux AppImage",
    "build-macos-x64": "electron-builder --x64 --mac dmg",

    "build-tar.xz-arm64": "electron-builder --arm64 --linux tar.xz",
    "build-deb-arm64": "electron-builder --arm64 --linux deb",
    "build-rpm-arm64": "electron-builder --arm64 --linux rpm",
    "build-snap-arm64": "electron-builder --arm64 --linux snap",
    "build-appimage-arm64": "electron-builder --arm64 --linux AppImage"
  },
  "dependencies": {
    "@jellybrick/mpris-service": "2.1.5"
  },
  "devDependencies": {
    "electron": "^38.4.0",
    "electron-builder": "^26.0.0"
  },
  "build": {
    "appId": "dev.aunetx.deezer",
    "files": ["**"],
    "directories": {
      "buildResources": "build",
      "output": "../artifacts/${arch}"
    },
    "extraResources": [
      {
        "from": "../extra/",
        "to": ".",
        "filter": ["**"]
      },
      {
        "from": "../",
        "to": ".",
        "filter": ["dev.aunetx.deezer.desktop", "dev.aunetx.deezer.svg"]
      }
    ],
    "linux": {
      "maintainer": "aunetx <me@aunetx.dev>",
      "icon": "../icons",
      "category": "AudioVideo;Audio;Player;Music;",
      "desktop": {
        "entry": {
          "Type": "Application",
          "Name": "Deezer",
          "GenericName": "Online music streaming service",
          "Comment": "Listen and download all your favorite music",
          "StartupNotify": "true",
          "Terminal": "false",
          "MimeType": "x-scheme-handler/deezer;",
          "Categories": "Audio;Music;Player;AudioVideo;",
          "Keywords": "Music;Player;Streaming;Online;",
          "StartupWMClass": "deezer-desktop",
          "SingleMainWindow": "true",
          "X-GNOME-UsesNotifications": "true"
        }
      },
      "artifactName": "${productName}-${version}-${arch}.${ext}"
    },
    "snap": {
      "artifactName": "${productName}_${version}_${arch}.${ext}",
      "publish": [
        {
          "provider": "generic",
          "url": "https://null/"
        }
      ],
      "base": "core22",
      "grade": "stable",
      "confinement": "classic",
      "after": ["desktop-gtk4", "libnotify-bin"],
      "slots": [
        {
          "mpris": {
            "name": "deezer"
          },
          "desktop": {
            "name": "deezer"
          }
        }
      ],
      "plugs": [
        "desktop",
        "desktop-legacy",
        "wayland",
        "x11",
        "unity7",
        "alsa",
        "avahi-observe",
        "browser-support",
        "gsettings",
        "network",
        "opengl",
        "audio-playback",
        "screen-inhibit-control",
        "upower-observe"
      ]
    },
    "deb": {
      "artifactName": "${productName}_${version}_${arch}.${ext}"
    },
    "rpm": {
      "artifactName": "${productName}-${version}.${arch}.${ext}"
    },
    "flatpak": {
      "artifactName": "${productName}-${version}-${arch}.${ext}",
      "runtime": "org.freedesktop.Platform",
      "runtimeVersion": "24.08",
      "sdk": "org.freedesktop.Sdk",
      "base": "org.electronjs.Electron2.BaseApp",
      "baseVersion": "24.08",
      "finishArgs": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--device=dri",
        "--env=TMPDIR=/var/tmp",
        "--talk-name=org.kde.StatusNotifierWatcher",
        "--talk-name=org.freedesktop.PowerManagement",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.gnome.SettingsDaemon",
        "--talk-name=org.gnome.SessionManager",
        "--own-name=org.mpris.MediaPlayer2.deezer",
        "--filesystem=xdg-music:ro"
      ],
      "modules": [
        {
          "name": "deezer",
          "buildsystem": "simple",
          "build-commands": [
            "mkdir -p /app",
            "cp -r . /app/",
            "mkdir -p /app/bin",
            "install -m0755 run.sh /app/bin/run.sh"
          ],
          "sources": [
            {
              "type": "script",
              "dest-filename": "run.sh",
              "commands": [
                "env XDG_CURRENT_DESKTOP=Unity zypak-wrapper /app/main/deezer-desktop \"$@\""
              ]
            }
          ]
        }
      ]
    }
  }
}
